#
# Script to take sixteen disks connected to a node's local HW RAID
# controller, and turn them into sixteen individual disks, striped with
# no redundancy, for high performance scratch space.
#

# Clear any existing disk config from the HW Raid controller
sudo /opt/MegaRAID/MegaCli/MegaCli64 -CfgClr -aALL

# Create a separate (RAID0) volume out of each individual disk
sudo /opt/MegaRAID/MegaCli/MegaCli64 CfgEachDskRaid0 WB ADRA Cached CachedBadBBU -aALL

# Tell Linux LVM to initialize each disk as a physical volume
sudo pvcreate -ff /dev/sd[a-p]

# Tell Linux LVM to create a volume group containing all these disks
sudo vgcreate bench16vg /dev/sd[a-p]

# Tell Linux LVM to create a single logical volume, striped across all
# sixteen disks, with a 128 byte chunk size
sudo lvcreate -n bench16lv -i16 -I128 -L 2.12T bench16vg

# Format the volume
sudo mkfs.xfs /dev/bench16vg/bench16lv

# Mount
sudo mount /dev/bench16vg/bench16lv /bench16

# Set perms the same as /tmp
sudo chmod 1777 /bench16



