#!/bin/bash

#
# 2015.02.13 Brian Finley <bfinley@lenovo.com>
#   - created based on input and discussion with Raj Panda
# 2015.02.17 Brian Finley <bfinley@lenovo.com>
#   - updated to clarify that base_freq is avx_base_freq
#

# vim:set tw=0:

# Change these two based on the desired CPU
#
# E5-2699
cores=18
avx_base_freq=1.9
#
# E5-2698a
#cores=18
#avx_base_freq=2.3
#
# E5-2698
#cores=16
#avx_base_freq=1.9


# Change node count to hit your target perf
node_count=1046

# Prolly don't need to change these
sockets=2       # Typical compute node
flops=16        # Appropriate for Haswell

#
# Don't change settings below here
#
node_efficiency=.92

# Cluster efficiency.  Leave at 1000 for 800-1200 node clusters
#cluster_efficiency=.98  # 100 node cluster
cluster_efficiency=.95  # 1000 node cluster
#cluster_efficiency=$( echo "scale=3; FORMULA_FROM_RAJ_GOES_HERE" | bc -l ) 

node_rmax=$( echo "scale=3; ($node_efficiency * $sockets * $cores * $avx_base_freq * $flops)" | bc -l )
echo Node RMax:  $node_rmax GFLOPs

cluster_rmax=$( echo "scale=3; $node_rmax * $node_count * $cluster_efficiency" | bc -l )
echo Cluster RMax:  $cluster_rmax GFLOPs

cluster_rmax=$( echo "scale=3; $cluster_rmax / 1000" | bc -l )
echo Cluster RMax:  $cluster_rmax TFLOPs

cluster_rmax=$( echo "scale=3; $cluster_rmax / 1000" | bc -l )
echo Cluster RMax:  $cluster_rmax PFLOPs

